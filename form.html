<!DOCTYPE html>
<html lang="en"><head>
  <base href="/" />
  <script src="./js/jquery.min.js"></script>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no,viewport-fit=cover">
  <title>2012 Jeep Wrangler Unlimited Rubicon Sport Utility 4D SUV for Sale - Carslyst</title>
  <link rel="preload" href="./css/style.css" as="style">
  <link rel="stylesheet" href="./css/style.css">
  <link rel="icon" href="./img/icon.png" type="image/png">
  <script src="./js/utlParam.js"></script>
<body>
<header id="header">
</header>

<main style="height: auto !important;">
  <div class="main" style="height: auto !important;">
    <div class="container detail">
    </div>

    <div class="bottom" style="height: auto !important;">

      <div class="container" style="height: auto !important;">

        <div class="contact-form" style="max-width: 728px; margin:auto; padding: 30px; background: #fff; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
          <form>
            <div class="form-group" style="margin-bottom: 20px;">
              <label for="name" style="display: block; margin-bottom: 8px; font-weight: bold;" id="lang_name">Full name</label>
              <input type="text" id="name" name="name" required="" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
              <label for="email" style="display: block; margin-bottom: 8px; font-weight: bold;">E-Mail</label>
              <input type="email" id="email" name="email" required="" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
              <label for="message" style="display: block; margin-bottom: 8px; font-weight: bold;" id="lang_beizhu">Leave a message here.</label>
              <textarea id="message" name="message" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
            </div>

            <button type="button" onclick="submitForm()" class="submit-btn" style="width: 100%; padding: 12px; background: #e32752; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;" id="lang_submit">Send contact request</button>
          </form>
        </div>

        <div class="car-bottom">

          <h2 id="makeInState">Jeep in Alabama</h2>

          <div class="car-list" id = "car-bottom">
            <div class="car-con">
              <div class="car-item">
                <a href="/used-cars/listing-7206/" class="link-cover"></a>
                <div class="car-pic">
                  <div class="car-pic-pop">POPULAR</div>
                  <img src="https://car.carslyst.com/public/static/Images/load-s.webp" alt="2021 Jeep Gladiator 4WD 80th Anniversary for Sale">
                  <div class="car-pic-tip">
                    <svg><use xlink:href="#icon-pic"></use></svg>
                    <span class="car-pic-num">1</span>
                  </div>
                </div>
                <div class="car-content">
                  <div class="car-title"></div>
                  <div class="car-info">
                    <div class="car-info-item">
                      <svg><use xlink:href="#icon-location"></use></svg>
                      <span>Alabaster</span>
                    </div>
                    <div class="car-info-item">
                      <svg><use xlink:href="#icon-date"></use></svg>
                      <span>Jan 03, 2024</span>
                    </div>
                  </div>
                  <div class="car-des"><p>2021 Jeep Gladiator 4WD 80th Anniversary.</p><p>Used 2021 30,093 miles Gray</p></div>
                  <div class="car-prices">$<span class="car-total">38,987</span></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="aside" style="height: auto !important;">
        <div class="aside-buy" style="height: auto !important;">
          <h2 id="typeInState">SUVs in Alabama</h2>
          <div class="car-list" style="height: auto !important;" id ="car-aside">
            <div class="car-con">
              <div class="car-item">
                <a href="/used-cars/listing-9067/" class="link-cover"></a>
                <div class="car-pic">
                  <img src="https://car.carslyst.com/public/static/Images/load-s.webp" alt="">
                  <div class="car-pic-tip">
                    <svg><use xlink:href="#icon-pic"></use></svg>
                    <span class="car-pic-num">1</span>
                  </div>
                </div>
                <div class="car-content">
                  <div class="car-title">2014 Chevrolet Captiva Sport 4d SUV FWD LT for Sale</div>
                  <div class="car-info">
                    <div class="car-info-item">
                      <svg><use xlink:href="#icon-location"></use></svg>
                      <span>Alabaster</span>
                    </div>
                    <div class="car-info-item">
                      <svg><use xlink:href="#icon-date"></use></svg>
                      <span>Jan 05, 2024</span>
                    </div>
                  </div>
                  <div class="car-des"><p>Features: 4-Cyl Flex Fuel 2.4 Liter, Automatic 6-Spd, ABS (4-Wheel), AM/FM Stereo, Air Bags (Side): Front, Air Bags: Dual Front, Air Bags: F and R Head Curtain, Air Conditioning, Bluetooth Connection, CD: MP3 (Single), Cruise Control, Daytime Running Lights, FWD, On Star, Power Door Locks, Power Steering, Power Windows, Seat: Power Driver, Sirius XM Satellite Radio, Stabili Trak, Tilt and Telescoping Wheel, Traction Control</p><p>Used 2014 Chevrolet Captiva Sport 138,034 miles, Silver</p></div>
                  <div class="car-prices">$<span class="car-total">12,995</span></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</main>

<footer  id="footer">
</footer>

<script>
  // 加载 header
  fetch('./header.html')
          .then(res => res.text())
          .then(data => {
            document.getElementById('header').innerHTML = data;

            $(".icon-nav").click(function() {
              $(".nav-cover").toggleClass('expand');
              $(".header-nav").toggleClass('expand');
            })
            $(".nav-cover").click(function() {
              $(".nav-cover").toggleClass('expand');
              $(".header-nav").toggleClass('expand');
            })

            $(".nav-item.expand .nav-con").on('click', function(e) {
              if ($(e.target).closest('.icon-go').length) {
                e.preventDefault();
                $(this).parent().find(".nav-sub-list").toggleClass("expand");
              }
            });
          });

  // 加载 footer
  fetch('./footer.html')
          .then(res => res.text())
          .then(data => {
            document.getElementById('footer').innerHTML = data;
          });
</script>

<script type="module">
  import {
    fetchListingById,
    fetchListings
  } from "./js/supabaseApi.js";

  /*
  ========================================
  Detail Page
  ========================================
  */

  async function loadDetailPage() {

    const match =
            window.location.pathname
                    .match(/listing-(\d+)/);

    // const id = match ? match[1] : null;

    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    // const id = 173124;

    console.log(id); // 输出: 123

    const { data } =
            await fetchListingById(id);

    return data
  }

  /*
  ========================================
  Bottom Cars
  ========================================
  */

  function renderCarsBottom(data) {

    const container =
            document.getElementById('car-bottom');

    container.innerHTML = '';

    data.forEach(car => {

      const image =
              car.image_cover === '404.jpg'
                      ? '404.jpg'
                      : car.image_cover;

      const div =
              document.createElement('div');

      div.className = 'car-con';

      div.innerHTML = `
<div class="car-item">

<a href="./detail.html?id=${car.id}"
class="link-cover"></a>

<div class="car-pic">

<div class="car-pic-pop">POPULAR</div>

<img src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/${image}" alt="${car.title}">

<div class="car-pic-tip">

<svg>
<use xlink:href="#icon-pic"></use>
</svg>

<span class="car-pic-num">1</span>

</div>

</div>

<div class="car-content">

<div class="car-title"></div>

<div class="car-info">

<div class="car-info-item">

<svg>
<use xlink:href="#icon-location"></use>
</svg>

<span>${car.location}</span>

</div>

<div class="car-info-item">

<svg>
<use xlink:href="#icon-date"></use>
</svg>

<span>${car.listing_date}</span>

</div>

</div>

<div class="car-des">

<p>${car.title}</p>

<p>${car.summary_description}</p>

</div>

${
              car.price !== null &&
              car.price !== undefined &&
              car.price !== ''
                      ? `<div class="car-prices">$<span class="car-total">${car.price}</span></div>`
                      : ''
      }

</div>

</div>
`;

      container.appendChild(div);

    });

  }

  async function loadBottom(data) {

    const result =
            await fetchListings({

              state: data.state,
              category: "",
              make: data.make,
              page: 1,
              limit: 15

            });

    if (result.error) {

      console.error(result.error);

      return;

    }

    renderCarsBottom(result.data);

  }

  /*
  ========================================
  Aside Cars
  ========================================
  */

  function renderCarsAside(data) {

    const container =
            document.getElementById('car-aside');

    container.innerHTML = '';

    data.forEach(car => {

      const image =
              car.image_cover === '404.jpg'
                      ? '404.jpg'
                      : car.image_cover;

      const div =
              document.createElement('div');

      div.className = 'car-con';

      div.innerHTML = `
<div class="car-con">

<div class="car-item">

<a href="./detail.html?id=${car.id}"
class="link-cover"></a>

<div class="car-pic">

<img src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/${image}" alt="">

<div class="car-pic-tip">

<svg>
<use xlink:href="#icon-pic"></use>
</svg>

<span class="car-pic-num">1</span>

</div>

</div>

<div class="car-content">

<div class="car-title">
${car.title}
</div>

<div class="car-info">

<div class="car-info-item">

<svg>
<use xlink:href="#icon-location"></use>
</svg>

<span>${car.location}</span>

</div>

<div class="car-info-item">

<svg>
<use xlink:href="#icon-date"></use>
</svg>

<span>${car.listing_date}</span>

</div>

</div>

<div class="car-des">
${car.summary_description}
</div>

${
              car.price !== null &&
              car.price !== undefined &&
              car.price !== ''
                      ? `<div class="car-prices">$<span class="car-total">${car.price}</span></div>`
                      : ''
      }

</div>

</div>

</div>
`;

      container.appendChild(div);

    });

  }

  async function loadAside(data) {

    const result =
            await fetchListings({

              state: data.state,
              category: data.category,
              make: "",
              page: 1,
              limit: 15

            });

    if (result.error) {

      console.error(result.error);

      return;

    }

    renderCarsAside(result.data);

  }

  /*
  ========================================
  Init
  ========================================
  */

  document.addEventListener("DOMContentLoaded", async () => {

    const data = await loadDetailPage();

    console.log(data);

    loadBottom(data)

    loadAside(data)

  });

</script>

<script>
  function submitForm() {
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    const name = $('#name').val();
    const email = $('#email').val();
    const message = $('#message').val();

    let alertMessage = ""
    let result_href = ``

    alertMessage = "Please complete all fields before submitting.";
    result_href = `./result.html?id=${id}`

    if(name.length == 0 || email.length == 0 || message.length == 0){
      alert(alertMessage)
    }else{
      window.location.href = result_href;
    }
  }
</script>



</body>
</html>