<!DOCTYPE html>
<html lang="en"><head>
  <script src="./js/jquery.min.js"></script>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no,viewport-fit=cover">
  <title>Used Car Listings | Find Affordable Vehicles - Carslyst</title>
  <link rel="preload" href="./css/style.css" as="style">
  <link rel="stylesheet" href="./css/style.css">
  <link rel="icon" href="./img/icon.png" type="image/png">
  <script src="./js/utlParam.js"></script>
<body>

<header id="header">
</header>

<div class="banner">
  <img src="./img/banner.webp" alt="Banner">
  <div class="banner-content">
    <h1 class="banner-title">Find Affordable <span>Used Cars</span></h1>
    <div class="banner-des">Discover local used car listings by make and type today!</div>
    <a href="/used-cars/" class="banner-btn" id = "viewAllListings">View All Listings</a>
  </div>
</div>
<main style="height: auto !important;">
  <div class="main" style="height: auto !important;">

    <div class="home-section">
      <h2>Used Cars <span>by Make</span></h2>
      <div class="home-content">
        <ul class="car-make-list" id="car-makes-list">
        </ul>
      </div>
    </div>
    <div class="home-section">
      <h2>Used Cars <span>by Type</span></h2>
      <div class="home-content">
        <ul class="car-type-list">
          <li class="car-type-item">
            <a href="/used-cars/suvs/" class="link-cover"></a>
            <div class="car-type-img">
              <img class="car-type-icon" src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/suvs.webp" alt="SUVs">
            </div>
            <a href="/used-cars/suvs/" class="car-type-name">SUVs</a>

          </li>
          <li class="car-type-item">
            <a href="/used-cars/trucks/" class="link-cover"></a>
            <div class="car-type-img">
              <img class="car-type-icon" src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/trucks.webp" alt="Trucks">
            </div>
            <a href="/used-cars/trucks/" class="car-type-name">Trucks</a>

          </li>
          <li class="car-type-item">
            <a href="/used-cars/sedans/" class="link-cover"></a>
            <div class="car-type-img">
              <img class="car-type-icon" src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/sedans.webp" alt="Sedans">
            </div>
            <a href="/used-cars/sedans/" class="car-type-name">Sedans</a>

          </li>
          <li class="car-type-item">
            <a href="/used-cars/hybrids/" class="link-cover"></a>
            <div class="car-type-img">
              <img class="car-type-icon" src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/hybrids.webp" alt="Hybrids">
            </div>
            <a href="/used-cars/hybrids/" class="car-type-name">Hybrids</a>

          </li>
          <li class="car-type-item">
            <a href="/used-cars/vans/" class="link-cover"></a>
            <div class="car-type-img">
              <img class="car-type-icon" src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/vans.webp" alt="Vans">
            </div>
            <a href="/used-cars/vans/" class="car-type-name">Vans</a>

          </li>
          <li class="car-type-item">
            <a href="/used-cars/coupes/" class="link-cover"></a>
            <div class="car-type-img">
              <img class="car-type-icon" src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/coupes.webp" alt="Coupes">
            </div>
            <a href="/used-cars/coupes/" class="car-type-name">Coupes</a>

          </li>
          <li class="car-type-item">
            <a href="/used-cars/hatchbacks/" class="link-cover"></a>
            <div class="car-type-img">
              <img class="car-type-icon" src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/hatchbacks.webp" alt="Hatchbacks">
            </div>
            <a href="/used-cars/hatchbacks/" class="car-type-name">Hatchbacks</a>

          </li>
          <li class="car-type-item">
            <a href="/used-cars/convertibles/" class="link-cover"></a>
            <div class="car-type-img">
              <img class="car-type-icon" src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/convertibles.webp" alt="Convertibles">
            </div>
            <a href="/used-cars/convertibles/" class="car-type-name">Convertibles</a>

          </li>
          <li class="car-type-item">
            <a href="/used-cars/motorcycles/" class="link-cover"></a>
            <div class="car-type-img">
              <img class="car-type-icon" src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/motorcycles.webp" alt="Motorcycles">
            </div>
            <a href="/used-cars/motorcycles/" class="car-type-name">Motorcycles</a>

          </li>
          <li class="car-type-item">
            <a href="/used-cars/classic-cars/" class="link-cover"></a>
            <div class="car-type-img">
              <img class="car-type-icon" src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/classic-cars.webp" alt="Classic Cars">
            </div>
            <a href="/used-cars/classic-cars/" class="car-type-name">Classic Cars</a>

          </li>
          <li class="car-type-item">
            <a href="/used-cars/rvs-and-campers/" class="link-cover"></a>
            <div class="car-type-img">
              <img class="car-type-icon" src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/rvs-and-campers.webp" alt="RVs &amp; Campers">
            </div>
            <a href="/used-cars/rvs-and-campers/" class="car-type-name">RVs &amp; Campers</a>

          </li>
          <li class="car-type-item">
            <a href="/used-cars/motorhomes/" class="link-cover"></a>
            <div class="car-type-img">
              <img class="car-type-icon" src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/motorhomes.webp" alt="Motorhomes">
            </div>
            <a href="/used-cars/motorhomes/" class="car-type-name">Motorhomes</a>

          </li>
          <li class="car-type-item">
            <a href="/used-cars/station-wagons/" class="link-cover"></a>
            <div class="car-type-img">
              <img class="car-type-icon" src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/station-wagons.webp" alt="Station Wagons">
            </div>
            <a href="/used-cars/station-wagons/" class="car-type-name">Station Wagons</a>

          </li>
          <li class="car-type-item">
            <a href="/used-cars/trailers/" class="link-cover"></a>
            <div class="car-type-img">
              <img class="car-type-icon" src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/trailers.webp" alt="Trailers">
            </div>
            <a href="/used-cars/trailers/" class="car-type-name">Trailers</a>

          </li>
        </ul>
      </div>
    </div>
    <div class="home-section">
      <h2>Used Cars <span>by State</span></h2>
      <div class="home-content">
        <div class="category-wrap state">
          <div class="category-wrap-con state">
            <ul class="category-list state">

            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<footer  id="footer">
</footer>

<script>
  // 加载 header
  fetch('./header.html')
          .then(res => res.text())
          .then(data => {
            document.getElementById('header').innerHTML = data;

            $(".icon-nav").click(function() {
              $(".nav-cover").toggleClass('expand');
              $(".header-nav").toggleClass('expand');
            })
            $(".nav-cover").click(function() {
              $(".nav-cover").toggleClass('expand');
              $(".header-nav").toggleClass('expand');
            })

            $(".nav-item.expand .nav-con").on('click', function(e) {
              if ($(e.target).closest('.icon-go').length) {
                e.preventDefault();
                $(this).parent().find(".nav-sub-list").toggleClass("expand");
              }
            });
          });

  // 加载 footer
  fetch('./footer.html')
          .then(res => res.text())
          .then(data => {
            document.getElementById('footer').innerHTML = data;
          });
</script>

<script type="module">



  import {
    fetchAllStates,
    fetchAllCategoriesWithCount
  } from './js/supabaseApi.js';

  // 州名 → 缩写
  const STATE_ABBR = {
    Alabama: "al",
    Alaska: "ak",
    Arizona: "az",
    Arkansas: "ar",
    California: "ca",
    Colorado: "co",
    Connecticut: "ct",
    Delaware: "de",
    "District of Columbia": "dc",
    Florida: "fl",
    Georgia: "ga",
    Hawaii: "hi",
    Idaho: "id",
    Illinois: "il",
    Indiana: "in",
    Iowa: "ia",
    Kansas: "ks",
    Kentucky: "ky",
    Louisiana: "la",
    Maine: "me",
    Maryland: "md",
    Massachusetts: "ma",
    Michigan: "mi",
    Minnesota: "mn",
    Mississippi: "ms",
    Missouri: "mo",
    Montana: "mt",
    Nebraska: "ne",
    Nevada: "nv",
    "New Hampshire": "nh",
    "New Jersey": "nj",
    "New Mexico": "nm",
    "New York": "ny",
    "North Carolina": "nc",
    "North Dakota": "nd",
    Ohio: "oh",
    Oklahoma: "ok",
    Oregon: "or",
    Pennsylvania: "pa",
    "Rhode Island": "ri",
    "South Carolina": "sc",
    "South Dakota": "sd",
    Tennessee: "tn",
    Texas: "tx",
    Utah: "ut",
    Vermont: "vt",
    Virginia: "va",
    Washington: "wa",
    "West Virginia": "wv",
    Wisconsin: "wi",
    Wyoming: "wy"
  };

  function formatNumber(num) {
    return Number(num).toLocaleString("en-US");
  }

  async function renderStates() {
    const { data: states, error } = await fetchAllStates();
    if (error || !states) return;

    const ul = document.querySelector(".category-list.state");
    if (!ul) return;

    ul.innerHTML = ""; // ✅ 真正清空



    states.forEach(({ state, total }) => {
      const abbr = STATE_ABBR[state];
      if (!abbr) return;
      let state_url = `./types.html?state=${state}`
      const li = document.createElement("li");
      li.className = "category-item";

      li.innerHTML = `
      <a href="${state_url}" class="link-cover"></a>
      <span class="category-text">${state}</span>
      <span class="category-count">
        <span class="general-num">${formatNumber(total)}</span>
      </span>
    `;

      ul.appendChild(li);
    });
  }

  async function init() {
    await renderStates();

    // 其他数据（如果你需要）
    const { data: categoryCounts } = await fetchAllCategoriesWithCount();
    console.log(categoryCounts);
  }

  document.addEventListener("DOMContentLoaded", init);

  document.getElementById("viewAllListings").href = "./states.html"

</script>

<script>
  const carMakes = [
    { name: "Toyota", image: "images/toyota.png" },
    { name: "Honda", image: "images/honda.png" },
    { name: "Ford", image: "images/ford.png" },
    { name: "Chevrolet", image: "images/chevrolet.png" },
    { name: "BMW", image: "images/bmw.png" },
    { name: "Mercedes-Benz", image: "images/mercedes-benz.png" },
    { name: "Audi", image: "images/audi.png" },
    { name: "Nissan", image: "images/nissan.png" },
    { name: "Hyundai", image: "images/hyundai.png" },
    { name: "Kia", image: "images/kia.png" }
  ];

  const list = document.getElementById("car-makes-list");

  carMakes.forEach(make => {

    const url = `./states.html?make=${encodeURIComponent(make.name)}`;

    const li = document.createElement("li");
    li.className = "car-make-item";

    li.innerHTML = `
    <a href="${url}" class="link-cover"></a>

    <div class="car-make-img">
      <img src="${"https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/"+make.image}" alt="${make.name}">
    </div>

    <a href="${url}" class="car-make-name">
      ${make.name}
    </a>
  `;

    list.appendChild(li);

  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {

    // 选择所有 car make 和 car type 的链接
    const links = document.querySelectorAll(
            ".car-make-item a, .car-type-item a"
    );

    links.forEach(link => {

      const href = link.getAttribute("href");

      if (!href) return;

      let makeName = null;

      // 匹配 /car-makes/toyota/
      const makeMatch = href.match(/\/car-makes\/([^\/]+)\//);

      // 匹配 /used-cars/suvs/
      const typeMatch = href.match(/\/used-cars\/([^\/]+)\//);

      if (makeMatch) {
        makeName = makeMatch[1];
      }
      else if (typeMatch) {
        makeName = typeMatch[1];
      }

      if (makeName) {

        // 转换为首字母大写格式
        makeName = makeName
                .split("-")
                .map(word =>
                        word.charAt(0).toUpperCase() + word.slice(1)
                )
                .join("-");


        if(makeName === 'Suvs'){makeName="SUVs"}
        if(makeName === 'Rvs-And-Campers'){makeName="RVs%20%26%20Campers"}

        const newUrl = `./states.html?category=${encodeURIComponent(makeName)}`;

        link.setAttribute("href", newUrl);

      }

    });

  });
</script>



</body>
</html>