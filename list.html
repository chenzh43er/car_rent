<!DOCTYPE html>
<html lang="en"><head>
  <base href="/" />
  <script src="./js/jquery.min.js"></script>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no,viewport-fit=cover">
  <title>Used SUVs for Sale in Alabama - Carslyst</title>
  <link rel="preload" href="./css/style.css" as="style">
  <link rel="stylesheet" href="./css/style.css">
  <link rel="icon" href="./img/icon.png" type="image/png">
  <script src="./js/utlParam.js"></script>
  <script src="./js/jquery.min.js"></script>
<body style="display: none" id = "mainBody">

<header id="header">
</header>

<main style="height: auto !important;">
  <div class="filter-cover">
  </div>
  <div class="main" style="height: auto !important;">
    <div class="container detail">
      <h1 id="titleForList">Used SUVs in Alabama</h1>
    </div>
    <div class="category-content" style="height: auto !important;">
      <div class="container" style="height: auto !important;">

        <div class="filter-banner">
          <div class="filter-scroll-container">
            <div class="filter-banner-btn state" id = "filter-banner-btn-state">
              <span class="banner-state-value" id = "banner-state-value">Alabama</span>
              <svg class="sort-go">
                <use xlink:href="#icon-go"></use>
              </svg>
              <ul class="filter-banner-list" id="filter-banner-btn-state-ul">
              </ul>
            </div>
            <div class="filter-banner-btn city" id = "filter-banner-btn-city">
              <span class="banner-city-value"  id = "banner-city-value">City</span>
              <svg class="sort-go">
                <use xlink:href="#icon-go"></use>
              </svg>
              <ul class="filter-banner-list" id="filter-banner-btn-city-ul">
                <li class="filter-banner-item"><a href="/used-cars/suvs/al/alabaster/">Alabaster</a></li>
              </ul>
            </div>

            <div class="filter-banner-btn make" style="display: none" id = "filter-banner-btn-make">
              <span class="banner-category-value" id="banner-make-value">Toyota</span>
              <svg class="sort-go">
                <use xlink:href="#icon-go"></use>
              </svg>
              <ul class="filter-banner-list" id="filter-banner-btn-make-ul">
              </ul>
            </div >

            <div class="filter-banner-btn type" style="display: none" id = "filter-banner-btn-type">
              <span class="banner-category-value" id = "banner-category-value">SUVs</span>
              <svg class="sort-go">
                <use xlink:href="#icon-go"></use>
              </svg>
              <ul class="filter-banner-list" id = "banner-category-value-ul">
                <li class="filter-banner-item active"><a href="/used-cars/suvs/al/">SUVs</a></li>
              </ul>
            </div>

            <div class="filter-banner-btn price">
              <span class="banner-price-value">Price Range</span>
              <svg class="sort-go">
                <use xlink:href="#icon-go"></use>
              </svg>
              <div class="price-range-wrap">
                <input class="min-price" type="text" placeholder="Min Price" >
                <input class="max-price" type="text" placeholder="Max Price" >
                <div class="filter-confirm-btn">Apply</div>
              </div>
            </div>
          </div>
        </div>
        <div class="sort-wrap">
          <div class="sort-section">
            <div class="filter-slide-wrap">
            </div>
          </div>
          <span class="sort-title"><span class="general-num"></span>  results found</span>

        </div>
        <div class="car-list" style="height: auto !important;">
        </div>
        <div class="page-wrap"><div class="brpp_pageGo"><span class="page-back">Previous</span> <a href="" class="page-cur">1</a><a href="/used-cars/suvs/al/?page=2" title="2" class="page-nor">2</a><a href="/used-cars/suvs/al/?page=3" title="3" class="page-nor">3</a><a href="/used-cars/suvs/al/?page=4" title="4" class="page-nor">4</a><p class="pageEllipsis">...</p><a href="/used-cars/suvs/al/?page=886" title="886" class="page-nor">886</a> <a href="/used-cars/suvs/al/?page=2" title="" class="page-next-active">Next<svg class="icon-next"><use xlink:href="#icon-next"></use></svg></a></div></div>
      </div>
      <div class="aside" style="height: auto !important;">
        <div class="aside-type">
          <h2>Browse by Make</h2>
          <ul class="aside-type-list number">

          </ul>
        </div>
      </div>
      <div class="filter-aside-wrap">
        <div class="filter-wrap">
          <span class="filter-title">Filter</span>
          <svg class="filter-close">
            <use xlink:href="#icon-close"></use>
          </svg>
        </div>
        <div class="filter-aside">
          <div class="filter-condition">
            <div class="condition-con">
              <div class="condition-title">
                <div class="condition-content">
                  <span class="condition-content-key">State</span>
                  <span class="condition-content-value">Alabama</span>
                </div>
                <svg class="icon-condition">
                  <use xlink:href="#icon-go"></use>
                </svg>
              </div>
              <div class="condition-list">
                <div class="condition-item state-info-name active">
                  <a href="/used-cars/suvs/al/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Alabama</div>
                  </div>
                  <span class="category-count"><span class="general-num">13,290</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/ak/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Alaska</div>
                  </div>
                  <span class="category-count"><span class="general-num">48</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/az/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Arizona</div>
                  </div>
                  <span class="category-count"><span class="general-num">787</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/ar/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Arkansas</div>
                  </div>
                  <span class="category-count"><span class="general-num">500</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/ca/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">California</div>
                  </div>
                  <span class="category-count"><span class="general-num">2,261</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/co/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Colorado</div>
                  </div>
                  <span class="category-count"><span class="general-num">925</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/ct/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Connecticut</div>
                  </div>
                  <span class="category-count"><span class="general-num">962</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/de/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Delaware</div>
                  </div>
                  <span class="category-count"><span class="general-num">103</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/fl/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Florida</div>
                  </div>
                  <span class="category-count"><span class="general-num">3,240</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/ga/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Georgia</div>
                  </div>
                  <span class="category-count"><span class="general-num">759</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/hi/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Hawaii</div>
                  </div>
                  <span class="category-count"><span class="general-num">39</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/id/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Idaho</div>
                  </div>
                  <span class="category-count"><span class="general-num">173</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/il/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Illinois</div>
                  </div>
                  <span class="category-count"><span class="general-num">1,536</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/in/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Indiana</div>
                  </div>
                  <span class="category-count"><span class="general-num">649</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/ia/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Iowa</div>
                  </div>
                  <span class="category-count"><span class="general-num">385</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/ks/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Kansas</div>
                  </div>
                  <span class="category-count"><span class="general-num">718</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/ky/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Kentucky</div>
                  </div>
                  <span class="category-count"><span class="general-num">408</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/la/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Louisiana</div>
                  </div>
                  <span class="category-count"><span class="general-num">2,720</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/me/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Maine</div>
                  </div>
                  <span class="category-count"><span class="general-num">142</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/md/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Maryland</div>
                  </div>
                  <span class="category-count"><span class="general-num">532</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/ma/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Massachusetts</div>
                  </div>
                  <span class="category-count"><span class="general-num">639</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/mi/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Michigan</div>
                  </div>
                  <span class="category-count"><span class="general-num">1,114</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/mn/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Minnesota</div>
                  </div>
                  <span class="category-count"><span class="general-num">529</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/ms/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Mississippi</div>
                  </div>
                  <span class="category-count"><span class="general-num">208</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/mo/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Missouri</div>
                  </div>
                  <span class="category-count"><span class="general-num">1,409</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/mt/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Montana</div>
                  </div>
                  <span class="category-count"><span class="general-num">168</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/ne/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Nebraska</div>
                  </div>
                  <span class="category-count"><span class="general-num">645</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/nv/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Nevada</div>
                  </div>
                  <span class="category-count"><span class="general-num">420</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/nh/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">New Hampshire</div>
                  </div>
                  <span class="category-count"><span class="general-num">890</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/nj/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">New Jersey</div>
                  </div>
                  <span class="category-count"><span class="general-num">1,447</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/nm/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">New Mexico</div>
                  </div>
                  <span class="category-count"><span class="general-num">223</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/ny/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">New York</div>
                  </div>
                  <span class="category-count"><span class="general-num">2,346</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/nc/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">North Carolina</div>
                  </div>
                  <span class="category-count"><span class="general-num">1,102</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/nd/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">North Dakota</div>
                  </div>
                  <span class="category-count"><span class="general-num">1,539</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/oh/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Ohio</div>
                  </div>
                  <span class="category-count"><span class="general-num">1,529</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/ok/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Oklahoma</div>
                  </div>
                  <span class="category-count"><span class="general-num">619</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/or/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Oregon</div>
                  </div>
                  <span class="category-count"><span class="general-num">400</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/pa/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Pennsylvania</div>
                  </div>
                  <span class="category-count"><span class="general-num">1,744</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/ri/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Rhode Island</div>
                  </div>
                  <span class="category-count"><span class="general-num">102</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/sc/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">South Carolina</div>
                  </div>
                  <span class="category-count"><span class="general-num">244</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/sd/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">South Dakota</div>
                  </div>
                  <span class="category-count"><span class="general-num">177</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/tn/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Tennessee</div>
                  </div>
                  <span class="category-count"><span class="general-num">1,352</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/tx/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Texas</div>
                  </div>
                  <span class="category-count"><span class="general-num">3,793</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/ut/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Utah</div>
                  </div>
                  <span class="category-count"><span class="general-num">823</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/vt/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Vermont</div>
                  </div>
                  <span class="category-count"><span class="general-num">120</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/va/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Virginia</div>
                  </div>
                  <span class="category-count"><span class="general-num">729</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/wa/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Washington</div>
                  </div>
                  <span class="category-count"><span class="general-num">1,939</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/wv/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">West Virginia</div>
                  </div>
                  <span class="category-count"><span class="general-num">165</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/wi/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Wisconsin</div>
                  </div>
                  <span class="category-count"><span class="general-num">1,042</span></span>
                </div>
                <div class="condition-item state-info-name">
                  <a href="/used-cars/suvs/wy/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Wyoming</div>
                  </div>
                  <span class="category-count"><span class="general-num">82</span></span>
                </div>
              </div>
            </div>
            <div class="condition-con expand">
              <div class="condition-title">
                <div class="condition-content">
                  <span class="condition-content-key">City</span>
                  <span class="condition-content-value">All Cities</span>
                </div>
                <svg class="icon-condition">
                  <use xlink:href="#icon-go"></use>
                </svg>
              </div>
              <div class="condition-list">
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/alabaster/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Alabaster</div>
                  </div>
                  <span class="category-count"><span class="general-num">12,797</span></span>
                </div>
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/anniston/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Anniston</div>
                  </div>
                  <span class="category-count"><span class="general-num">8</span></span>
                </div>
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/auburn/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Auburn</div>
                  </div>
                  <span class="category-count"><span class="general-num">95</span></span>
                </div>
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/daphne/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Daphne</div>
                  </div>
                  <span class="category-count"><span class="general-num">97</span></span>
                </div>
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/dothan/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Dothan</div>
                  </div>
                  <span class="category-count"><span class="general-num">47</span></span>
                </div>
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/enterprise/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Enterprise</div>
                  </div>
                  <span class="category-count"><span class="general-num">8</span></span>
                </div>
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/eufaula/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Eufaula</div>
                  </div>
                  <span class="category-count"><span class="general-num">1</span></span>
                </div>
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/foley/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Foley</div>
                  </div>
                  <span class="category-count"><span class="general-num">1</span></span>
                </div>
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/fort-payne/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Fort Payne</div>
                  </div>
                  <span class="category-count"><span class="general-num">1</span></span>
                </div>
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/huntsville/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Huntsville</div>
                  </div>
                  <span class="category-count"><span class="general-num">8</span></span>
                </div>
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/jasper/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Jasper</div>
                  </div>
                  <span class="category-count"><span class="general-num">27</span></span>
                </div>
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/mobile/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Mobile</div>
                  </div>
                  <span class="category-count"><span class="general-num">79</span></span>
                </div>
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/montgomery/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Montgomery</div>
                  </div>
                  <span class="category-count"><span class="general-num">48</span></span>
                </div>
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/theodore/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Theodore</div>
                  </div>
                  <span class="category-count"><span class="general-num">1</span></span>
                </div>
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/tuscaloosa/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Tuscaloosa</div>
                  </div>
                  <span class="category-count"><span class="general-num">30</span></span>
                </div>
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/tuscumbia/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Tuscumbia</div>
                  </div>
                  <span class="category-count"><span class="general-num">16</span></span>
                </div>
                <div class="condition-item">
                  <a href="/used-cars/suvs/al/wetumpka/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Wetumpka</div>
                  </div>
                  <span class="category-count"><span class="general-num">26</span></span>
                </div>
              </div>
            </div>
            <div class="condition-con">
              <div class="condition-title">
                <div class="condition-content">
                  <span class="condition-content-key">Car Type</span>
                  <span class="condition-content-value">SUVs</span>
                </div>
                <svg class="icon-condition">
                  <use xlink:href="#icon-go"></use>
                </svg>
              </div>
              <div class="condition-list">
                <div class="condition-item category-info-name active">
                  <a href="/used-cars/suvs/al/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">SUVs</div>
                  </div>
                  <span class="category-count"><span class="general-num">13,290</span></span>
                </div>
                <div class="condition-item category-info-name">
                  <a href="/used-cars/trucks/al/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Trucks</div>
                  </div>
                  <span class="category-count"><span class="general-num">9,251</span></span>
                </div>
                <div class="condition-item category-info-name">
                  <a href="/used-cars/sedans/al/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Sedans</div>
                  </div>
                  <span class="category-count"><span class="general-num">12,183</span></span>
                </div>
                <div class="condition-item category-info-name">
                  <a href="/used-cars/hybrids/al/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Hybrids</div>
                  </div>
                  <span class="category-count"><span class="general-num">6,311</span></span>
                </div>
                <div class="condition-item category-info-name">
                  <a href="/used-cars/vans/al/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Vans</div>
                  </div>
                  <span class="category-count"><span class="general-num">4,929</span></span>
                </div>
                <div class="condition-item category-info-name">
                  <a href="/used-cars/coupes/al/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Coupes</div>
                  </div>
                  <span class="category-count"><span class="general-num">5,356</span></span>
                </div>
                <div class="condition-item category-info-name">
                  <a href="/used-cars/hatchbacks/al/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Hatchbacks</div>
                  </div>
                  <span class="category-count"><span class="general-num">6,022</span></span>
                </div>
                <div class="condition-item category-info-name">
                  <a href="/used-cars/convertibles/al/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Convertibles</div>
                  </div>
                  <span class="category-count"><span class="general-num">2,930</span></span>
                </div>
                <div class="condition-item category-info-name">
                  <a href="/used-cars/motorcycles/al/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Motorcycles</div>
                  </div>
                  <span class="category-count"><span class="general-num">99</span></span>
                </div>
                <div class="condition-item category-info-name">
                  <a href="/used-cars/classic-cars/al/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Classic Cars</div>
                  </div>
                  <span class="category-count"><span class="general-num">2,815</span></span>
                </div>
                <div class="condition-item category-info-name">
                  <a href="/used-cars/rvs-and-campers/al/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">RVs &amp; Campers</div>
                  </div>
                  <span class="category-count"><span class="general-num">3,264</span></span>
                </div>
                <div class="condition-item category-info-name">
                  <a href="/used-cars/motorhomes/al/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Motorhomes</div>
                  </div>
                  <span class="category-count"><span class="general-num">3,377</span></span>
                </div>
                <div class="condition-item category-info-name">
                  <a href="/used-cars/station-wagons/al/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Station Wagons</div>
                  </div>
                  <span class="category-count"><span class="general-num">1,725</span></span>
                </div>
                <div class="condition-item category-info-name">
                  <a href="/used-cars/trailers/al/" class="link-cover"></a>
                  <div class="condition-btn">
                    <div class="condition-radio">
                      <div class="condition-radio-inner"></div>
                    </div>
                    <div class="condition-name">Trailers</div>
                  </div>
                  <span class="category-count"><span class="general-num">2,597</span></span>
                </div>
              </div>
            </div>
            <div class="condition-con expand">
              <div class="condition-title">
                <div class="condition-content">
                  <span class="condition-content-key">Price Range</span>
                  <span class="condition-content-value price-subvalue">All</span>
                </div>
                <svg class="icon-condition">
                  <use xlink:href="#icon-go"></use>
                </svg>
              </div>
              <div class="condition-list price">
                <input class="min-price" type="text" placeholder="Min Price" oninput="formatMinAccountNumber(this)">
                <span class="condition-divide"></span>
                <input class="max-price" type="text" placeholder="Max Price" oninput="formatMaxAccountNumber(this)">
              </div>
            </div>
          </div>
        </div>
        <div class="condition-filter-wrap">
          <div class="condition-filter">Apply Filter</div>
        </div>
      </div>

    </div>
  </div>
</main>

<footer  id="footer">
</footer>

<script>
  // 加载 header
  fetch('./header.html')
          .then(res => res.text())
          .then(data => {
            document.getElementById('header').innerHTML = data;

            $(".icon-nav").click(function() {
              $(".nav-cover").toggleClass('expand');
              $(".header-nav").toggleClass('expand');
            })
            $(".nav-cover").click(function() {
              $(".nav-cover").toggleClass('expand');
              $(".header-nav").toggleClass('expand');
            })

            $(".nav-item.expand .nav-con").on('click', function(e) {
              if ($(e.target).closest('.icon-go').length) {
                e.preventDefault();
                $(this).parent().find(".nav-sub-list").toggleClass("expand");
              }
            });
          });

  // 加载 footer
  fetch('./footer.html')
          .then(res => res.text())
          .then(data => {
            document.getElementById('footer').innerHTML = data;
          });
</script>

<script type="module">

  import { fetchListings, fetchPopularMakesByState } from './js/supabaseApi.js';

  const limit = 15;

  function getParams() {

    const url = new URL(window.location.href);

    const segments =
            url.pathname
                    .split('/')
                    .filter(Boolean);

    let category = null;
    let make = null;
    let state = null;

    if (segments.length >= 2) {
      category = segments[1];
    }

    if (segments.length >= 3) {
      state = segments[2];
    }

    const page =
            parseInt(url.searchParams.get('page')) || 1;

    return {
      state,
      category,
      make,
      page
    };
  }


  function formatNumber(num) {
    return Number(num).toLocaleString("en-US");
  }


  function renderCars(data) {

    const container = document.querySelector('.car-list');

    container.innerHTML = '';

    data.forEach(car => {

      const image =
              car.image_cover === '404.jpg'
                      ? '/public/static/Images/placeholder.webp'
                      : car.image_cover;

      const div = document.createElement('div');

      div.className = 'car-con';

      let detail_url = `./detail.html?id=${car.id}`

      div.innerHTML = `
            <div class="car-item">
              <a href="${detail_url}" class="link-cover"></a>
              <div class="car-pic">
                <div class="car-pic-pop">POPULAR</div>
                <img src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/${car.image_cover}" alt="${car.title}">
                <div class="car-pic-tip">
                  <svg><use xlink:href="#icon-pic"></use></svg>
                  <span class="car-pic-num">1</span>
                </div>
              </div>
              <div class="car-content ">
                <div class="car-title">${car.title}</div>
                <div class="car-info">
                  <div class="car-info-item">
                    <svg><use xlink:href="#icon-location"></use></svg>
                    <span>${car.location}</span>
                  </div>
                  <div class="car-info-item">
                    <svg><use xlink:href="#icon-date"></use></svg>
                    <span>${car.listing_date}</span>
                  </div>
                </div>
                <div class="car-des">
                    ${car.summary_description}
                </div>
               ${
              car.price !== null && car.price !== undefined && car.price !== ''
                      ? `<div class="car-prices">$<span class="car-total">${car.price}</span></div>`
                      : ''}
              </div>
            </div>
        `;

      container.appendChild(div);

    });

  }


  function buildPageUrl(page) {

    const url = new URL(window.location.href);

    url.searchParams.set('page', page);

    return url.pathname + url.search;
  }


  function renderPagination(page, totalPages) {

    const container =
            document.querySelector('.brpp_pageGo');

    container.innerHTML = '';

    if (page > 1) {

      container.innerHTML += `
        <a href="${buildPageUrl(page-1)}"
           class="page-back">
           Previous
        </a>
        `;

    } else {

      container.innerHTML += `
        <span class="page-back">
           Previous
        </span>
        `;
    }


    const maxVisible = 5;

    let start =
            Math.max(1, page - 2);

    let end =
            Math.min(totalPages, start + maxVisible - 1);


    if (start > 1) {

      container.innerHTML += `
        <a href="${buildPageUrl(1)}"
           class="page-nor">1</a>
        <p class="pageEllipsis">...</p>
        `;
    }


    for (let i = start; i <= end; i++) {

      if (i === page) {

        container.innerHTML += `
            <a class="page-cur">${i}</a>
            `;

      } else {

        container.innerHTML += `
            <a href="${buildPageUrl(i)}"
               class="page-nor">${i}</a>
            `;
      }

    }


    if (end < totalPages) {

      container.innerHTML += `
        <p class="pageEllipsis">...</p>
        <a href="${buildPageUrl(totalPages)}"
           class="page-nor">${totalPages}</a>
        `;
    }


    if (page < totalPages) {

      container.innerHTML += `
        <a href="${buildPageUrl(page+1)}"
           class="page-next-active">
           Next
        </a>
        `;

    } else {

      container.innerHTML += `
        <span class="page-next">
           Next
        </span>
        `;
    }

  }


  async function loadPage() {

    const params = getParams();

    const param = new URLSearchParams(window.location.search);

// ===== string params =====
    let make = param.get("make") || "";
    let state = param.get("state") || "";
    let city = param.get("city") || "";
    let category = param.get("category") || "";

// ===== number params =====
    let minPrice = param.get("minprice");
    let maxPrice = param.get("maxprice");

// ⭐ number 转换（非常重要）
    minPrice = minPrice !== null ? Number(minPrice) : null;
    maxPrice = maxPrice !== null ? Number(maxPrice) : null;

// ===== title 生成 =====
    let textTitle = "Used";

    if (category && make) {
      textTitle += ` ${make}, ${category}`;
    } else if (category) {
      textTitle += ` ${category}`;
    } else if (make) {
      textTitle += ` ${make}`;
    } else {
      textTitle += ` Cars`;
    }

// location 拼接
    if (city && state) {
      textTitle += ` in ${city}, ${state}`;
    } else if (state) {
      textTitle += ` in ${state}`;
    }

// price 拼接（可选 SEO 强化）
    if (minPrice !== null || maxPrice !== null) {
      if (minPrice !== null && maxPrice !== null) {
        textTitle += ` ($${minPrice} - $${maxPrice})`;
      } else if (minPrice !== null) {
        textTitle += ` (>$${minPrice})`;
      } else {
        textTitle += ` (<$${maxPrice})`;
      }
    }

    document.getElementById("titleForList").innerText = textTitle;

// ===== fetch =====
    const result = await fetchListings({
      state,
      city,
      category,
      make,
      minPrice,
      maxPrice,
      page: params.page,
      limit
    });

    const totalElement =
            document.querySelector('.sort-title .general-num');

    if (totalElement) {
      totalElement.textContent =
              formatNumber(result.count);
    }


    if (result.error) {

      console.error(result.error);

      return;
    }


    renderCars(result.data);

    renderPagination(
            result.page,
            result.totalPages
    );

    return result

  }



  const STATE_ABBR = {
    Alabama: "al",
    Alaska: "ak",
    Arizona: "az",
    Arkansas: "ar",
    California: "ca",
    Colorado: "co",
    Connecticut: "ct",
    Delaware: "de",
    "District of Columbia": "dc",
    Florida: "fl",
    Georgia: "ga",
    Hawaii: "hi",
    Idaho: "id",
    Illinois: "il",
    Indiana: "in",
    Iowa: "ia",
    Kansas: "ks",
    Kentucky: "ky",
    Louisiana: "la",
    Maine: "me",
    Maryland: "md",
    Massachusetts: "ma",
    Michigan: "mi",
    Minnesota: "mn",
    Mississippi: "ms",
    Missouri: "mo",
    Montana: "mt",
    Nebraska: "ne",
    Nevada: "nv",
    "New Hampshire": "nh",
    "New Jersey": "nj",
    "New Mexico": "nm",
    "New York": "ny",
    "North Carolina": "nc",
    "North Dakota": "nd",
    Ohio: "oh",
    Oklahoma: "ok",
    Oregon: "or",
    Pennsylvania: "pa",
    "Rhode Island": "ri",
    "South Carolina": "sc",
    "South Dakota": "sd",
    Tennessee: "tn",
    Texas: "tx",
    Utah: "ut",
    Vermont: "vt",
    Virginia: "va",
    Washington: "wa",
    "West Virginia": "wv",
    Wisconsin: "wi",
    Wyoming: "wy"
  };


  async function renderPopularMakes(stateName) {

    const { data, error } =
            await fetchPopularMakesByState(stateName);

    if (error || !data) return;

    const ul = document.querySelector(
            ".aside-type-list.number"
    );

    ul.innerHTML = "";

    const stateAbbr = STATE_ABBR[stateName];

    data.forEach(item => {

      const makeName = item.make;
      const count = item.count;
      const image = item.make_img.replace("https://cdn.carslyst.com/car-make/","");

      const li = document.createElement("li");

      li.className = "aside-type-item";

      let next_urlList = `./list.html?make=${makeName}&state=${stateName}`

      li.innerHTML = `
      <a href="${next_urlList}"
         class="link-cover"></a>

      <img class="aside-type-img"
           src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/${image}"
           alt="${makeName}">

      <span>
        <a href="${next_urlList}"
           class="aside-type-name">
           ${makeName} for Sale
        </a>

        <span class="aside-type-count general-num">
          ${formatNumber(item.count)}
        </span>
      </span>
    `;

      ul.appendChild(li);

    });

  }

  document.addEventListener("DOMContentLoaded", async () => {

    await loadPage();

    const param = new URLSearchParams(window.location.search);
    let state = param.get("state");
    await renderPopularMakes(state);

    document.getElementById("mainBody").style.display = "block";

  });


</script>

<script type="module">
  import { fetchAllStates, fetchPopularMakesByState, fetchCategoriesByState,fetchCitiesByState,fetchMakesByState } from './js/supabaseApi.js';

  const stateListEl = document.getElementById("filter-banner-btn-state-ul")

  async function renderStates() {

    let stateUrl = `./`

    const { data: states, error } = await fetchAllStates();

    const param = new URLSearchParams(window.location.search);
    let state = param.get("state");

    document.getElementById("banner-state-value").innerText = state

    stateListEl.innerHTML = states.map((state, index) => {

      const url = new URL(window.location.href);
      url.searchParams.set('state', state.state); // 改 state

      return `
    <li class="filter-banner-item">
      <a href="${url.pathname + url.search}">${state.state}</a>
    </li>
  `;
    }).join('');
  }

  async function renderCities() {

    const param = new URLSearchParams(window.location.search);
    let make = param.get("make");
    let state = param.get("state");
    let category = param.get("category");
    let city = param.get("city");
    const label = document.getElementById('banner-city-value');

    if (!make) {
      make = ""
    }

    if (!state) {
      state = ""
    }

    if (!category) {
      category = ""
    }

    if (!city) {
      city = ""
      label.innerText = "City"
    }else{
      label.innerText = city
    }

    const ul = document.getElementById('filter-banner-btn-city-ul');


    // loading UI
    ul.innerHTML = '<li class="filter-banner-item">Loading...</li>';

    const { data: cities, error } = await fetchCitiesByState(state);

    if (!cities || cities.length === 0) {
      ul.innerHTML = '<li class="filter-banner-item">No cities</li>';
      return;
    }

    // 清空
    ul.innerHTML = '';

    cities.forEach(({ city }) => {

      const url = new URL(window.location.href);

      url.searchParams.set('city', city);

      const slug = city.toLowerCase().replace(/\s+/g, '-');

      const li = document.createElement('li');
      li.className = 'filter-banner-item';

      const a = document.createElement('a');
      a.href = url.toString();
      a.textContent = city;

      li.appendChild(a);
      ul.appendChild(li);
    });
  }

  async function renderCategories() {
    const param = new URLSearchParams(window.location.search);
    let state = param.get("state");

    let category = param.get("category");

    const ul = document.getElementById('banner-category-value-ul');
    const label = document.getElementById('banner-category-value');
    label.innerText = category

    ul.innerHTML = '<li class="filter-banner-item">Loading...</li>';

    const { data: categories, error } = await fetchCategoriesByState(state);

    if (!categories.length) {
      ul.innerHTML = '<li class="filter-banner-item">No categories</li>';
      return;
    }

    ul.innerHTML = '';

    categories.forEach(({ category }) => {

      const li = document.createElement('li');
      li.className = 'filter-banner-item';

      const a = document.createElement('a');
      a.textContent = category;

      // ⭐ 无刷新
      a.addEventListener('click', (e) => {
        e.preventDefault();

        const url = new URL(window.location.href);
        url.searchParams.set('category', category);

        window.location.href = url;   // ⭐ 刷新
      });

      li.appendChild(a);
      ul.appendChild(li);
    });
  }

  async function renderMakes() {

    // ⭐ 获取 state（query + path fallback）
    const params = new URLSearchParams(window.location.search);
    let state = params.get('state');
    let make = params.get("make");

    if (!state) {
      const parts = window.location.pathname.replace(/^\/|\/$/g, '').split('/');
      state = parts[2];
    }

    document.getElementById("banner-make-value").innerText = make

    const ul = document.getElementById('filter-banner-btn-make-ul');
    const label = document.getElementById('banner-make-value');

    ul.innerHTML = '<li class="filter-banner-item">Loading...</li>';

    const { data: makes, error } = await fetchMakesByState(state);

    if (!makes || !makes.length) {
      ul.innerHTML = '<li class="filter-banner-item">No makes</li>';
      return;
    }

    const currentMake = new URL(window.location.href).searchParams.get('make');

    ul.innerHTML = '';

    makes.forEach(({ make, total }) => {

      const li = document.createElement('li');
      li.className = 'filter-banner-item';

      const a = document.createElement('a');
      a.href = '#';
      a.textContent = total ? `${make} (${total})` : make;

      a.addEventListener('click', (e) => {
        e.preventDefault();

        const url = new URL(window.location.href);
        url.searchParams.set('make', make);

        // ⭐ SEO filter → 刷新
        window.location.href = url;
      });

      li.appendChild(a);
      ul.appendChild(li);
    });
  }

  renderStates();
  renderCities();

  const param = new URLSearchParams(window.location.search);
  let make = param.get("make");
  let category = param.get("category");

  if (!make) {
    make = ""
    document.getElementById("filter-banner-btn-type").style.display = "flex"
    renderCategories();
  }

  if (!category) {
    category = ""
    document.getElementById("filter-banner-btn-make").style.display = "flex"
    renderMakes();
  }





</script>

<script>

  if(sessionStorage.getItem('subTipNumber')) {
    var subTipNumber = sessionStorage.getItem('subTipNumber');
    subTipNumber ++;
    sessionStorage.setItem('subTipNumber', subTipNumber);
  }else {
    sessionStorage.setItem('subTipNumber', 1);
  }

  $("body").click(function(){
    $('.sort-btn, .filter-banner-btn').removeClass('expand');
  })

  $(".sort-btn, .filter-banner-btn").click(function() {
    event.stopPropagation()

    if ($(this).hasClass('expand')) {
      $(this).removeClass('expand');
    } else {
      $('.sort-btn, .filter-banner-btn').removeClass('expand');
      $(this).addClass('expand');
    }
  })
  $(".price-range-wrap input, .price-range-wrap .filter-confirm-btn").click(function(event) {
    event.stopPropagation();
  });

  var isClickBackTopDouble = sessionStorage.getItem('isClickBackTopDouble') || false;

  $("#popup-back").click(function(){
    if(sessionStorage.getItem('clickBackTopNumber')) {
      var clickBackTopNumber = sessionStorage.getItem('clickBackTopNumber');
      clickBackTopNumber ++;
      sessionStorage.setItem('clickBackTopNumber', clickBackTopNumber);
      if(clickBackTopNumber >= 2) {
        sessionStorage.setItem('isClickBackTopDouble', true);
      }
    }else {
      sessionStorage.setItem('clickBackTopNumber', 1);
    }
  });

  window.onload=function() {
    setTimeout(toSubscribed,3000);
    $("#popup-back").click(function(){
      $(this).hide()
    });
  }



  var oldUrl = window.location.href
  var url = ''
  var originUrl = ''
  var params = ''
  var paramsMinpr = '';
  var paramsMaxpr = '';
  var paramsOrder = '';
  var paramsPage = '';
  // var paramsSearch = '';
  if(oldUrl.includes('?')) {
    originUrl = oldUrl.split('?')[0]
    params = oldUrl.split('?')[1]

    paramsArr = params.split('&')
    paramsArr.forEach(item => {
      if(item.includes('minprice')) {
        paramsMinpr = item.split('=')[1]
      }
      if(item.includes('maxprice')) {
        paramsMaxpr = item.split('=')[1]
      }
      if(item.includes('order')) {
        paramsOrder = item.split('=')[1]
      }
      if(item.includes('page')) {
        paramsPage = item.split('=')[1]
      }
      // if(item.includes('q=')) {
      //     paramsSearch = item.split('=')[1]
      // }
    });

    if($(".brpp_pageGo").children().eq(-2).text().replace(',','') == paramsPage) {
      $(".page-back-active").show();
    }
  }

  var minPrice = ''
  var maxPrice = ''
  minPrice = paramsMinpr.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  $(".min-price").each(function() {
    $(this).val(minPrice ? `$ ${minPrice}` : '');
  })
  maxPrice = paramsMaxpr.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  $(".max-price").each(function() {
    $(this).val(maxPrice ? `$ ${maxPrice}` : '');
  })

  if(minPrice == '' && maxPrice == '') {
    $(".price-subvalue").text('All')
  }else if (minPrice !== '' && maxPrice == '') {
    $(".price-subvalue").text(`Min $${minPrice}`);
    $(".banner-price-value").text(`Min $${minPrice}`);
  }else if(minPrice == '' && maxPrice !== '') {
    $(".price-subvalue").text(`Max $${maxPrice}`);
    $(".banner-price-value").text(`Max $${maxPrice}`);
  }else {
    $(".price-subvalue").text(`$${minPrice} - $${maxPrice}`);
    $(".banner-price-value").text(`$${minPrice} - $${maxPrice}`);
  }

  if(paramsOrder) {
    if(paramsOrder == 'priceasc') {
      $(".sort-value").text('Price Low')
    }else if(paramsOrder == 'pricedesc') {
      $(".sort-value").text('Price High')
    }
    $(".sort-item").each(function() {
      if($(this).attr('data-order') == paramsOrder) {
        $(this).addClass('active')
      }
    })
  }else {
    $(".sort-value").text('Date')
    $(".sort-item").each(function() {
      if($(this).attr('data-order') == 'date') {
        $(this).addClass('active')
      }
    })
  }

  var newUrl = ''
  $(".sort-item").each(function() {
    $(this).click(function() {
      event.stopPropagation()
      let sortValue = $(this).text()
      let sortSlug = $(this).attr('data-order')
      $('.sort-btn').removeClass('expand')
      $(".sort-value").text(sortValue)
      if(sortSlug == 'date') {
        if(oldUrl.includes('?')) {
          if(paramsMinpr == '' && paramsMaxpr == '') {
            newUrl = originUrl
          }else if(paramsMinpr !== '' && paramsMaxpr == '') {
            newUrl = originUrl + '?minprice=' + paramsMinpr
          }else if(paramsMaxpr !== '' && paramsMinpr == '') {
            newUrl = originUrl + '?maxprice=' + paramsMaxpr
          }else {
            newUrl = originUrl + '?minprice=' + paramsMinpr + '&maxprice=' + paramsMaxpr
          }
        }else {
          var newUrl = originUrl
        }
      }else {
        if(oldUrl.includes('?')) {
          if(paramsMinpr == '' && paramsMaxpr == '') {
            newUrl = originUrl + '?order=' + sortSlug
          }else if(paramsMinpr !== '' && paramsMaxpr == '') {
            newUrl = originUrl + '?minprice=' + paramsMinpr
            newUrl = newUrl + '&order=' + sortSlug
          }else if(paramsMaxpr !== '' && paramsMinpr == '') {
            newUrl = originUrl + '?maxprice=' + paramsMaxpr
            newUrl = newUrl + '&order=' + sortSlug
          }else {
            newUrl = originUrl + '?minprice=' + paramsMinpr + '&maxprice=' + paramsMaxpr
            newUrl = newUrl + '&order=' + sortSlug
          }
        }else {
          var newUrl = originUrl + '?order=' + sortSlug
        }
      }
      window.location.href = newUrl;
    })
  })

  $(".condition-title").each(function() {
    $(this).click(function() {
      $(this).parent().toggleClass('expand')
    })
  })

  $(".condition-item").each(function() {
    $(this).click(function() {
      $(this).addClass('active').siblings().removeClass('active')
    })
  })

  $('#search-text, #min-price, #max-price').on('keypress', function(event) {
    if (event.which === 13) {
      handleFilter();
    }
  });

  $(".condition-filter, .filter-confirm-btn").click(function() {
    event.stopPropagation();
    handleFilter()
  })

  function handleFilter() {

    let min = document.querySelector(".min-price").value;
    let max = document.querySelector(".max-price").value;

    // ⭐⭐ 关键清洗：去掉 $, 逗号, 空格
    function clean(v) {
      return v.replace(/[^\d]/g, "");
    }

    min = clean(min);
    max = clean(max);

    const url = new URL(window.location.href);

    if (min) url.searchParams.set("minprice", min);
    else url.searchParams.delete("minprice");

    if (max) url.searchParams.set("maxprice", max);
    else url.searchParams.delete("maxprice");

    window.location.href = url.toString();
  }

  function formatMinAccountNumber(input) {
    let value = input.value.replace(/[^\d]/g, '');
    value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    input.value = value ? `$ ${value}` : '';
    minPrice = value ? value : ''
  }
  function formatMaxAccountNumber(input) {
    let value = input.value.replace(/[^\d]/g, '');
    value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    input.value = value ? `$ ${value}` : '';
    maxPrice = value ? value : ''
  }


  $(".filter-clear").click(function() {
    if(oldUrl.includes('search/?q=')) {
      window.location.href = url
    }else {
      window.location.href = originUrl
    }
  })


  $(".popup-text").html("Click <strong>Allow</strong>  to receive updates on used car listings and find your ideal budget car!")
  $("#popup-back").click(function () {
    document.getElementById("popup-back").style.display = "none"
  })

  $(".icon-nav").click(function() {
    $(".nav-cover").toggleClass('expand');
    $(".header-nav").toggleClass('expand');
    checkNav()
  })
  $(".nav-cover").click(function() {
    $(".nav-cover").toggleClass('expand');
    $(".header-nav").toggleClass('expand');
    checkNav()
  })

  $(".nav-item.expand .nav-con").on('click', function(e) {
    if ($(e.target).closest('.icon-go').length) {
      e.preventDefault();
      $(this).parent().find(".nav-sub-list").toggleClass("expand");
    }
  });

  var backTop = 0
  function checkFilter() {
    if ($('.filter-aside-wrap').css('display') !== 'none') {
      var top = $(window).scrollTop()
      backTop = top
      $('body').css({
        'position': 'fixed',
        'width': '100%',
        'top': -top
      })
    } else {
      $('body').css({
        'position': 'absolute',
        'width': '100%',
        'top': 0
      })
      window.scrollTo(0, backTop);
    }
  }

  window.LazyLoadManager = {
    imageObserver: null,
    init() {
      if ('IntersectionObserver' in window) {
        this.initWithIntersectionObserver();
      } else {
        this.initWithFallback();
      }
    },
    initWithIntersectionObserver() {
      this.imageObserver = new IntersectionObserver(
              (entries, observer) => {
                entries.forEach(entry => {
                  if (entry.isIntersecting) {
                    this.loadImage(entry.target);
                    observer.unobserve(entry.target);
                  }
                });
              },
              {
                rootMargin: '50px 0px',
                threshold: 0.01
              }
      );

      this.observeImages();
    },
    initWithFallback() {
      const throttledLazyload = this.throttle(this.checkImages.bind(this), 200);
      document.addEventListener('DOMContentLoaded', () => this.checkImages());
      window.addEventListener('scroll', throttledLazyload);
    },
    loadImage(img) {
      const src = img.dataset.src;
      if (!src) {
        img.removeAttribute('lazyload');
        return Promise.resolve(img);
      }

      return new Promise((resolve, reject) => {
        const newImg = new Image();

        newImg.onload = () => {
          img.src = src;
          img.removeAttribute('data-src');
          img.removeAttribute('lazyload');
          resolve(img);
        };

        newImg.onerror = () => {
          img.removeAttribute('data-src');
          img.removeAttribute('lazyload');
          resolve(img);
        };

        newImg.src = src;
      })
    },
    observeImages() {
      const images = document.querySelectorAll('img[data-src][lazyload]');
      if (this.imageObserver) {
        images.forEach(img => this.imageObserver.observe(img));
      }
    },
    checkImages() {
      const viewHeight = window.innerHeight || document.documentElement.clientHeight;
      const images = document.querySelectorAll('img[data-src][lazyload]');

      images.forEach(img => {
        const rect = img.getBoundingClientRect();
        if (rect.bottom >= 0 && rect.top < viewHeight) {
          this.loadImage(img);
        }
      });
    },
    throttle(fn, delay) {
      let timer = null;
      let lastTime = 0;

      return (...args) => {
        const now = Date.now();

        if (now - lastTime >= delay) {
          fn.apply(this, args);
          lastTime = now;
        } else if (!timer) {
          timer = setTimeout(() => {
            fn.apply(this, args);
            lastTime = now;
            timer = null;
          }, delay);
        }
      };
    }
  }
  document.addEventListener('DOMContentLoaded', () => {
    window.LazyLoadManager.init();
  });


  const formatNumber = (number) => {
    return new Intl.NumberFormat('en-US').format(number);
  };

  function removeEmptyAds() {
    const adsList = document.querySelectorAll('.ad-layout, .ads-grid, .car-item-ad, .ads-article, .ads-normal');

    adsList.forEach(adContainer => {
      const isEmpty = !adContainer.innerHTML.trim();
      const insElement = adContainer.querySelector('ins');
      const isUnfilled = insElement && insElement.getAttribute('data-ad-status') === 'unfilled';

      if (isEmpty || isUnfilled) {
        adContainer.remove();
      }
    });
  }
  document.addEventListener('DOMContentLoaded', removeEmptyAds);
  const observer = new MutationObserver(removeEmptyAds);
  observer.observe(document.body, {
    childList: true,
    subtree: true
  });


  $(".general-num").each(function () {
    const num = $(this).text();
    $(this).text(formatNumber(num));
  })
  $(".car-total").each(function () {
    const num = $(this).text();
    $(this).text(formatNumber(num));
  })

  $(".buy-total").each(function () {
    const num = $(this).text();
    $(this).text(formatNumber(num));
  })

  $(".footer-top").click(function() {
    window.scrollTo({
      top: 0,
      left: 0,
      behavior: 'smooth'
    });
  })

  function checkNav() {
    var top = $(window).scrollTop()
    if ($('.header-nav').css('display') !== 'none') {
      $('body').css({
        'position': 'fixed',
        'width': '100%',
        'top': 0
      })
    } else {
      $('body').css({
        'position': 'absolute',
        'width': '100%',
      })
    }
  }

  function throttle(func, wait) {
    let lastTime = 0;
    return function() {
      const now = Date.now();
      if (now - lastTime >= wait) {
        func.apply(this, arguments);
        lastTime = now;
      }
    }
  }

  function handleImageSources() {
    const lazyImages = document.querySelectorAll('.car-pic img[src*="load"]');
    const viewportWidth = window.innerWidth;

    lazyImages.forEach(img => {
      if (viewportWidth > 680) {
        img.src = img.src.replace('load-l.webp', 'load-s.webp');
      } else {
        img.src = img.src.replace('load-s.webp', 'load-l.webp');
      }
    });
  }
  document.addEventListener('DOMContentLoaded', handleImageSources);
  window.addEventListener('resize', throttle(handleImageSources, 200));


  var address = '103.177.80.169' ? '103.177.80.169' : '';
  var push_sites = 'car' ? 'car' : '';
</script>
<script src="/public/static/Js/main.js?v-11"></script>

<script>

  var categoryInfoName = 'Toyota'
  var stateInfoName = 'Connecticut'



  $('.state-info-name').each(function () {
    if ($(this).find('.condition-name').text() == stateInfoName) {
      $(this).addClass('active')
    }
  })
  $('.filter-banner-btn.state .filter-banner-item').each(function () {
    if ($(this).text() == stateInfoName) {
      $(this).addClass('active')
    }
  })

  $('.category-info-name').each(function () {
    if ($(this).find('.condition-name').text() == categoryInfoName) {
      $(this).addClass('active')
    }
  })
  $('.filter-banner-btn.type .filter-banner-item').each(function () {
    if ($(this).text() == categoryInfoName) {
      $(this).addClass('active')
    }
  })

  $(".filter-btn").click(function () {
    $(".filter-aside-wrap").toggleClass('expand')
    $(".filter-cover").toggleClass('expand')
    checkFilter()
  })
  $(".filter-close").click(function () {
    $(".filter-aside-wrap").toggleClass('expand')
    $(".filter-cover").toggleClass('expand')
    checkFilter()
  })
  $(".filter-cover").click(function () {
    $(".filter-aside-wrap").toggleClass('expand')
    $(".filter-cover").toggleClass('expand')
    checkFilter()
  })

</script>

</body>
</html>