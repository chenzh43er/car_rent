<!DOCTYPE html>
<html lang="en"><head>
    <base href="/" />
  <script src="./js/jquery.min.js"></script>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no,viewport-fit=cover">
  <title>Used Cars for Sale in Alabama - Carslyst</title>
  <link rel="preload" href="./css/style.css" as="style">
  <link rel="stylesheet" href="./css/style.css">
    <link rel="icon" href="./img/icon.png" type="image/png">
    <script src="./js/utlParam.js"></script>
<body>
<header id="header">
</header>

<main style="height: auto !important;">
  <div class="main" style="height: auto !important;">
    <div class="container detail">
      <h1 id="titleForTypes">Used Cars in Alabama</h1>
    </div>
    <div class="bottom" style="height: auto !important;">
      <div class="container" style="height: auto !important;">
        <div class="general-wrap">
          <h2>Browse by Type</h2>
          <ul class="general-list brand-list type">
            <li class="general-item">
              <a href="/used-cars/suvs/al/" class="link-cover"></a>
              <div class="brand-pic type">
                <img class="brand-icon" src="/public/static/Images/types/suvs.webp" alt="SUVs">
              </div>
              <a href="/used-cars/suvs/al/" class="brand-name">SUVs</a>
            </li>
            <li class="general-item">
              <a href="/used-cars/trucks/al/" class="link-cover"></a>
              <div class="brand-pic type">
                <img class="brand-icon" src="/public/static/Images/types/trucks.webp" alt="Trucks">
              </div>
              <a href="/used-cars/trucks/al/" class="brand-name">Trucks</a>
            </li>
            <li class="general-item">
              <a href="/used-cars/sedans/al/" class="link-cover"></a>
              <div class="brand-pic type">
                <img class="brand-icon" src="/public/static/Images/types/sedans.webp" alt="Sedans">
              </div>
              <a href="/used-cars/sedans/al/" class="brand-name">Sedans</a>
            </li>
            <li class="general-item">
              <a href="/used-cars/hybrids/al/" class="link-cover"></a>
              <div class="brand-pic type">
                <img class="brand-icon" src="/public/static/Images/types/hybrids.webp" alt="Hybrids">
              </div>
              <a href="/used-cars/hybrids/al/" class="brand-name">Hybrids</a>
            </li>
            <li class="general-item">
              <a href="/used-cars/vans/al/" class="link-cover"></a>
              <div class="brand-pic type">
                <img class="brand-icon" src="/public/static/Images/types/vans.webp" alt="Vans">
              </div>
              <a href="/used-cars/vans/al/" class="brand-name">Vans</a>
            </li>
            <li class="general-item">
              <a href="/used-cars/coupes/al/" class="link-cover"></a>
              <div class="brand-pic type">
                <img class="brand-icon" src="/public/static/Images/types/coupes.webp" alt="Coupes">
              </div>
              <a href="/used-cars/coupes/al/" class="brand-name">Coupes</a>
            </li>
            <li class="general-item">
              <a href="/used-cars/hatchbacks/al/" class="link-cover"></a>
              <div class="brand-pic type">
                <img class="brand-icon" src="/public/static/Images/types/hatchbacks.webp" alt="Hatchbacks">
              </div>
              <a href="/used-cars/hatchbacks/al/" class="brand-name">Hatchbacks</a>
            </li>
            <li class="general-item">
              <a href="/used-cars/convertibles/al/" class="link-cover"></a>
              <div class="brand-pic type">
                <img class="brand-icon" src="/public/static/Images/types/convertibles.webp" alt="Convertibles">
              </div>
              <a href="/used-cars/convertibles/al/" class="brand-name">Convertibles</a>
            </li>
            <li class="general-item">
              <a href="/used-cars/motorcycles/al/" class="link-cover"></a>
              <div class="brand-pic type">
                <img class="brand-icon" src="/public/static/Images/types/motorcycles.webp" alt="Motorcycles">
              </div>
              <a href="/used-cars/motorcycles/al/" class="brand-name">Motorcycles</a>
            </li>
            <li class="general-item">
              <a href="/used-cars/classic-cars/al/" class="link-cover"></a>
              <div class="brand-pic type">
                <img class="brand-icon" src="/public/static/Images/types/classic-cars.webp" alt="Classic Cars">
              </div>
              <a href="/used-cars/classic-cars/al/" class="brand-name">Classic Cars</a>
            </li>
            <li class="general-item">
              <a href="/used-cars/rvs-and-campers/al/" class="link-cover"></a>
              <div class="brand-pic type">
                <img class="brand-icon" src="/public/static/Images/types/rvs-and-campers.webp" alt="RVs &amp; Campers">
              </div>
              <a href="/used-cars/rvs-and-campers/al/" class="brand-name">RVs &amp; Campers</a>
            </li>
            <li class="general-item">
              <a href="/used-cars/motorhomes/al/" class="link-cover"></a>
              <div class="brand-pic type">
                <img class="brand-icon" src="/public/static/Images/types/motorhomes.webp" alt="Motorhomes">
              </div>
              <a href="/used-cars/motorhomes/al/" class="brand-name">Motorhomes</a>
            </li>
            <li class="general-item">
              <a href="/used-cars/station-wagons/al/" class="link-cover"></a>
              <div class="brand-pic type">
                <img class="brand-icon" src="/public/static/Images/types/station-wagons.webp" alt="Station Wagons">
              </div>
              <a href="/used-cars/station-wagons/al/" class="brand-name">Station Wagons</a>
            </li>
            <li class="general-item">
              <a href="/used-cars/trailers/al/" class="link-cover"></a>
              <div class="brand-pic type">
                <img class="brand-icon" src="/public/static/Images/types/trailers.webp" alt="Trailers">
              </div>
              <a href="/used-cars/trailers/al/" class="brand-name">Trailers</a>
            </li>
          </ul>
        </div>
        <div class="general-wrap">
          <h2>Browse by States</h2>
          <ul class="general-list state-list">

          </ul>
        </div>
      </div>
      <div class="aside" style="height: auto !important;">
        <div class="aside-type">
          <h2>Browse by Make</h2>
          <ul class="aside-type-list number">
            <li class="aside-type-item">
              <a href="/car-makes/toyota/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/toyota.png" alt="Toyota">
              <span>
                                <a href="/car-makes/toyota/al/" class="aside-type-name">Toyota for Sale</a>
                                <span class="aside-type-count general-num">6,102</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/honda/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/honda.png" alt="Honda">
              <span>
                                <a href="/car-makes/honda/al/" class="aside-type-name">Honda for Sale</a>
                                <span class="aside-type-count general-num">5,282</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/nissan/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/nissan.png" alt="Nissan">
              <span>
                                <a href="/car-makes/nissan/al/" class="aside-type-name">Nissan for Sale</a>
                                <span class="aside-type-count general-num">2,646</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/hyundai/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/hyundai.png" alt="Hyundai">
              <span>
                                <a href="/car-makes/hyundai/al/" class="aside-type-name">Hyundai for Sale</a>
                                <span class="aside-type-count general-num">6,189</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/ford/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/ford.png" alt="Ford">
              <span>
                                <a href="/car-makes/ford/al/" class="aside-type-name">Ford for Sale</a>
                                <span class="aside-type-count general-num">8,801</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/chevrolet/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/chevrolet.png" alt="Chevrolet">
              <span>
                                <a href="/car-makes/chevrolet/al/" class="aside-type-name">Chevrolet for Sale</a>
                                <span class="aside-type-count general-num">8,692</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/jeep/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/jeep.png" alt="Jeep">
              <span>
                                <a href="/car-makes/jeep/al/" class="aside-type-name">Jeep for Sale</a>
                                <span class="aside-type-count general-num">1,737</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/bmw/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/bmw.png" alt="BMW">
              <span>
                                <a href="/car-makes/bmw/al/" class="aside-type-name">BMW for Sale</a>
                                <span class="aside-type-count general-num">2,692</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/mercedes-benz/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/mercedes-benz.png" alt="Mercedes-Benz">
              <span>
                                <a href="/car-makes/mercedes-benz/al/" class="aside-type-name">Mercedes-Benz for Sale</a>
                                <span class="aside-type-count general-num">2,759</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/kia/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/kia.png" alt="Kia">
              <span>
                                <a href="/car-makes/kia/al/" class="aside-type-name">Kia for Sale</a>
                                <span class="aside-type-count general-num">1,593</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/volkswagen/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/volkswagen.png" alt="Volkswagen">
              <span>
                                <a href="/car-makes/volkswagen/al/" class="aside-type-name">Volkswagen for Sale</a>
                                <span class="aside-type-count general-num">1,354</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/gmc/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/gmc.png" alt="GMC">
              <span>
                                <a href="/car-makes/gmc/al/" class="aside-type-name">GMC for Sale</a>
                                <span class="aside-type-count general-num">1,506</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/dodge/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/dodge.png" alt="Dodge">
              <span>
                                <a href="/car-makes/dodge/al/" class="aside-type-name">Dodge for Sale</a>
                                <span class="aside-type-count general-num">1,457</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/subaru/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/subaru.png" alt="Subaru">
              <span>
                                <a href="/car-makes/subaru/al/" class="aside-type-name">Subaru for Sale</a>
                                <span class="aside-type-count general-num">886</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/lexus/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/lexus.png" alt="Lexus">
              <span>
                                <a href="/car-makes/lexus/al/" class="aside-type-name">Lexus for Sale</a>
                                <span class="aside-type-count general-num">844</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/mazda/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/mazda.png" alt="Mazda">
              <span>
                                <a href="/car-makes/mazda/al/" class="aside-type-name">Mazda for Sale</a>
                                <span class="aside-type-count general-num">1,050</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/ram/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/ram.png" alt="RAM">
              <span>
                                <a href="/car-makes/ram/al/" class="aside-type-name">RAM for Sale</a>
                                <span class="aside-type-count general-num">2,562</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/tesla/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/tesla.png" alt="Tesla">
              <span>
                                <a href="/car-makes/tesla/al/" class="aside-type-name">Tesla for Sale</a>
                                <span class="aside-type-count general-num">236</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/audi/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/audi.png" alt="Audi">
              <span>
                                <a href="/car-makes/audi/al/" class="aside-type-name">Audi for Sale</a>
                                <span class="aside-type-count general-num">944</span>
                            </span>
            </li>
            <li class="aside-type-item">
              <a href="/car-makes/cadillac/al/" class="link-cover"></a>
              <img class="aside-type-img" src="https://cdn.carslyst.com/car-make/cadillac.png" alt="Cadillac">
              <span>
                                <a href="/car-makes/cadillac/al/" class="aside-type-name">Cadillac for Sale</a>
                                <span class="aside-type-count general-num">716</span>
                            </span>
            </li>
          </ul>
        </div></div>
      </div>
    </div>
  </div>
</main>

<footer  id="footer">
</footer>


<script>
  // 加载 header
  fetch('./header.html')
          .then(res => res.text())
          .then(data => {
            document.getElementById('header').innerHTML = data;

            $(".icon-nav").click(function() {
              $(".nav-cover").toggleClass('expand');
              $(".header-nav").toggleClass('expand');
            })
            $(".nav-cover").click(function() {
              $(".nav-cover").toggleClass('expand');
              $(".header-nav").toggleClass('expand');
            })

            $(".nav-item.expand .nav-con").on('click', function(e) {
              if ($(e.target).closest('.icon-go').length) {
                e.preventDefault();
                $(this).parent().find(".nav-sub-list").toggleClass("expand");
              }
            });
          });

  // 加载 footer
  fetch('./footer.html')
          .then(res => res.text())
          .then(data => {
            document.getElementById('footer').innerHTML = data;
          });
</script>

<script type="module">
    import {
        fetchAllStates,
        fetchCategoriesByState,
        fetchPopularMakesByState
    } from "./js/supabaseApi.js";

    /** 州名 → 缩写（全局共用） */
    const STATE_ABBR = {
        Alabama: "al",
        Alaska: "ak",
        Arizona: "az",
        Arkansas: "ar",
        California: "ca",
        Colorado: "co",
        Connecticut: "ct",
        Delaware: "de",
        "District of Columbia": "dc",
        Florida: "fl",
        Georgia: "ga",
        Hawaii: "hi",
        Idaho: "id",
        Illinois: "il",
        Indiana: "in",
        Iowa: "ia",
        Kansas: "ks",
        Kentucky: "ky",
        Louisiana: "la",
        Maine: "me",
        Maryland: "md",
        Massachusetts: "ma",
        Michigan: "mi",
        Minnesota: "mn",
        Mississippi: "ms",
        Missouri: "mo",
        Montana: "mt",
        Nebraska: "ne",
        Nevada: "nv",
        "New Hampshire": "nh",
        "New Jersey": "nj",
        "New Mexico": "nm",
        "New York": "ny",
        "North Carolina": "nc",
        "North Dakota": "nd",
        Ohio: "oh",
        Oklahoma: "ok",
        Oregon: "or",
        Pennsylvania: "pa",
        "Rhode Island": "ri",
        "South Carolina": "sc",
        "South Dakota": "sd",
        Tennessee: "tn",
        Texas: "tx",
        Utah: "ut",
        Vermont: "vt",
        Virginia: "va",
        Washington: "wa",
        "West Virginia": "wv",
        Wisconsin: "wi",
        Wyoming: "wy"
    };

    /** 数字格式化 */
    function formatNumber(num) {
        return Number(num).toLocaleString("en-US");
    }

    /** 从 URL 获取州名 */
    function getStateFromURL() {
        // 例: /used-cars/ca/
        const parts = window.location.pathname.split("/").filter(Boolean);
        const abbr = parts[1]; // used-cars/{abbr}/

        if (!abbr) return null;

        return Object.keys(STATE_ABBR).find(
            state => STATE_ABBR[state] === abbr
        );
    }

    /** 渲染州列表 */
    async function renderStateList() {
        const { data: states, error } = await fetchAllStates();
        if (error || !states) return;

        const ul = document.querySelector(".general-list.state-list");
        if (!ul) return;

        ul.innerHTML = "";



        states.forEach(({ state }) => {
            const abbr = STATE_ABBR[state];
            if (!abbr) return;
            let next_url = `./types.html?state=${state}`
            const li = document.createElement("li");
            li.className = "general-item";

            li.innerHTML = `
        <a href="${next_url}" class="general-link">
          <span class="general-name">${state}</span>
        </a>
      `;

            ul.appendChild(li);
        });
    }

    /** 渲染分类 */
    async function renderCategoriesByState(stateName) {
        if (!stateName) return;

        const stateAbbr = STATE_ABBR[stateName];
        if (!stateAbbr) return;

        const { data, error } =
            await fetchCategoriesByState(stateName);

        if (error || !data) return;

        const ul = document.querySelector(
            ".general-list.brand-list.type"
        );
        if (!ul) return;

        ul.innerHTML = "";

        data.forEach(item => {

            let category_Str = item.category
            if(item.category === 'RVs & Campers'){category_Str = "RVs%20%26%20Campers"}

            let next_url =
                `./list.html?state=${stateName}&category=${category_Str}`;

            const imgBase =
                "https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/";

            const li = document.createElement("li");
            li.className = "general-item";

            li.innerHTML = `
        <a href="${next_url}" class="link-cover"></a>

        <div class="brand-pic type">
          <img class="brand-icon"
               src="${imgBase + item.category_img}"
               alt="${item.category}">
        </div>

        <a href="${next_url}" class="brand-name">
          ${item.category}
        </a>
      `;

            ul.appendChild(li);
        });
    }

    /** 渲染热门品牌 */
    async function renderPopularMakes(stateName) {

        if (!stateName) return;

        const stateAbbr = STATE_ABBR[stateName];

        const { data, error } =
            await fetchPopularMakesByState(stateName);

        if (error || !data) return;

        const ul =
            document.querySelector(".aside-type-list.number");

        if (!ul) return;

        ul.innerHTML = "";

        data.forEach(item => {

            let next_url = `./list.html?state=${stateName}&make=${item.make}`

            const image =
                item.make_img.replace(
                    "https://cdn.carslyst.com/car-make/",
                    ""
                );

            const li = document.createElement("li");

            li.className = "aside-type-item";

            li.innerHTML = `
        <a href="${next_url}" class="link-cover"></a>

        <img class="aside-type-img"
             src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/${image}"
             alt="${item.make}">

        <span>
          <a href="${next_url}" class="aside-type-name">
            ${item.make} for Sale
          </a>

          <span class="aside-type-count general-num">
            ${formatNumber(item.count)}
          </span>
        </span>
      `;

            ul.appendChild(li);

        });
    }

    /** 页面初始化 */
    document.addEventListener("DOMContentLoaded", () => {

        const params = new URLSearchParams(window.location.search);

        const make = params.get("make");
        const state = params.get("state");
        const category = params.get("category");

        // const stateName = getStateFromURL()
        //     || "District of Columbia"; // fallback


        document.getElementById('titleForTypes').innerText = `Used Cars in ${state}`

        renderStateList();

        renderCategoriesByState(state);

        renderPopularMakes(state);

    });

</script>


</body>
</html>