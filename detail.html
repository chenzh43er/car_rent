<!DOCTYPE html>
<html lang="en"><head>
  <base href="/" />
  <script src="./js/jquery.min.js"></script>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no,viewport-fit=cover">
  <title>2012 Jeep Wrangler Unlimited Rubicon Sport Utility 4D SUV for Sale - Carslyst</title>
  <link rel="preload" href="./css/style.css" as="style">
  <link rel="stylesheet" href="./css/style.css">
  <link rel="icon" href="./img/icon.png" type="image/png">
  <script src="./js/utlParam.js"></script>
  <style>
    .detail-form {
      padding: 16px;
      font-family: GoogleSans;
    }

    .btn-group {
      display: flex;
      gap: 12px;
    }

    .btn {
      flex: 1;
      padding: 12px 0;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: all .2s ease; /* ⭐ hover过渡 */

    }

    /* 主按钮 */
    .primary {
      background: #e32752;
      color: #fff;
    }

    /* hover 略微变深 */
    .primary:hover {
      background: #c91f46;
    }

    /* 次按钮 */
    .secondary {
      background: #f2f3f5;
      color: #333;
    }

    .secondary:hover {
      background: #e5e6eb;
    }

    /* 移动端 */
    @media (max-width: 768px) {
      .btn-group {
        flex-direction: column;
      }
    }
    </style>
<body>
<header id="header">
</header>

<main style="height: auto !important;">
  <div class="main" style="height: auto !important;">
    <div class="container detail">
      <h1>2012 Jeep Wrangler Unlimited Rubicon Sport Utility 4D SUV for Sale
        <span class="detail-price">$<span class="car-total">19,400</span></span>
      </h1>

    </div>

    <div class="bottom" style="height: auto !important;">

      <div class="container" style="height: auto !important;">
        <div class="ad-layout"></div>
        <div class="image-slide">
          <div class="slide-list">
            <div class="slide-img-con" id = "slide-img">
<!--              <img class="slide-img" src="https://cdn.carslyst.com/listing/2024-03/2050306.jpg">-->
            </div>

          </div>
        </div>
        <div class="ad-layout"></div>
        <div class="detail-features" style="height: auto !important;">
          <div class="features-top">
            <h2>Detailed Information</h2>
            <div class="vin-href">
              <a target="_blank" href="/vin-lookup/1C4HJWFG5CL198701/" class="vin-link">VIN Report</a>
              <svg class="vin-next">
                <use xlink:href="#icon-next"></use>
              </svg>
            </div>
          </div>

          <div class="features-content">
            <ul>
            </ul>
          </div>
          <div class="features-des">
          </div>
          <div class="ad-layout"></div>
        </div>

        <div class="detail-form">
          <div class="btn-group">
            <button class="btn primary" onclick="goForm()">Contact us</button>
            <button class="btn secondary" onclick="goState()">Back to list</button>
          </div>
        </div>
        <div class="car-bottom">

          <h2 id="makeInState">Jeep in Alabama</h2>

          <div class="car-list" id = "car-bottom">
            <div class="car-con">
              <div class="car-item">
                <a href="/used-cars/listing-7206/" class="link-cover"></a>
                <div class="car-pic">
                  <div class="car-pic-pop">POPULAR</div>
                  <img src="https://car.carslyst.com/public/static/Images/load-s.webp" alt="2021 Jeep Gladiator 4WD 80th Anniversary for Sale">
                  <div class="car-pic-tip">
                    <svg><use xlink:href="#icon-pic"></use></svg>
                    <span class="car-pic-num">1</span>
                  </div>
                </div>
                <div class="car-content">
                  <div class="car-title"></div>
                  <div class="car-info">
                    <div class="car-info-item">
                      <svg><use xlink:href="#icon-location"></use></svg>
                      <span>Alabaster</span>
                    </div>
                    <div class="car-info-item">
                      <svg><use xlink:href="#icon-date"></use></svg>
                      <span>Jan 03, 2024</span>
                    </div>
                  </div>
                  <div class="car-des"><p>2021 Jeep Gladiator 4WD 80th Anniversary.</p><p>Used 2021 30,093 miles Gray</p></div>
                  <div class="car-prices">$<span class="car-total">38,987</span></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="aside" style="height: auto !important;">
        <div class="aside-buy" style="height: auto !important;">
          <h2 id="typeInState">SUVs in Alabama</h2>
          <div class="car-list" style="height: auto !important;" id ="car-aside">
            <div class="car-con">
              <div class="car-item">
                <a href="/used-cars/listing-9067/" class="link-cover"></a>
                <div class="car-pic">
                  <img src="https://car.carslyst.com/public/static/Images/load-s.webp" alt="">
                  <div class="car-pic-tip">
                    <svg><use xlink:href="#icon-pic"></use></svg>
                    <span class="car-pic-num">1</span>
                  </div>
                </div>
                <div class="car-content">
                  <div class="car-title">2014 Chevrolet Captiva Sport 4d SUV FWD LT for Sale</div>
                  <div class="car-info">
                    <div class="car-info-item">
                      <svg><use xlink:href="#icon-location"></use></svg>
                      <span>Alabaster</span>
                    </div>
                    <div class="car-info-item">
                      <svg><use xlink:href="#icon-date"></use></svg>
                      <span>Jan 05, 2024</span>
                    </div>
                  </div>
                  <div class="car-des"><p>Features: 4-Cyl Flex Fuel 2.4 Liter, Automatic 6-Spd, ABS (4-Wheel), AM/FM Stereo, Air Bags (Side): Front, Air Bags: Dual Front, Air Bags: F and R Head Curtain, Air Conditioning, Bluetooth Connection, CD: MP3 (Single), Cruise Control, Daytime Running Lights, FWD, On Star, Power Door Locks, Power Steering, Power Windows, Seat: Power Driver, Sirius XM Satellite Radio, Stabili Trak, Tilt and Telescoping Wheel, Traction Control</p><p>Used 2014 Chevrolet Captiva Sport 138,034 miles, Silver</p></div>
                  <div class="car-prices">$<span class="car-total">12,995</span></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</main>

<footer  id="footer">
</footer>

<script>
  // 加载 header
  fetch('./header.html')
          .then(res => res.text())
          .then(data => {
            document.getElementById('header').innerHTML = data;

            $(".icon-nav").click(function() {
              $(".nav-cover").toggleClass('expand');
              $(".header-nav").toggleClass('expand');
            })
            $(".nav-cover").click(function() {
              $(".nav-cover").toggleClass('expand');
              $(".header-nav").toggleClass('expand');
            })

            $(".nav-item.expand .nav-con").on('click', function(e) {
              if ($(e.target).closest('.icon-go').length) {
                e.preventDefault();
                $(this).parent().find(".nav-sub-list").toggleClass("expand");
              }
            });
          });

  // 加载 footer
  fetch('./footer.html')
          .then(res => res.text())
          .then(data => {
            document.getElementById('footer').innerHTML = data;
          });
</script>

<script type="module">
  import {
    fetchListingById,
    fetchListings
  } from "./js/supabaseApi.js";

  /*
  ========================================
  Detail Page
  ========================================
  */

  async function loadDetailPage() {

    const match =
            window.location.pathname
                    .match(/listing-(\d+)/);

    // const id = match ? match[1] : null;

    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    // const id = 173124;

    console.log(id); // 输出: 123




    const { data } =
            await fetchListingById(id);

    renderListingDetail(data);

    return data
  }

  export function renderListingDetail(item) {

    if (!item) return;

    function formatPrice(price) {

      if (!price) return null;

      return Number(price)
              .toLocaleString("en-US");

    }

    function safe(value) {

      if (value === null || value === undefined)
        return "";

      return value;

    }

    function parseDetails(details) {

      if (!details) return {};

      if (typeof details === "object")
        return details;

      try {

        return JSON.parse(details);

      } catch {

        return {};

      }

    }

    const details = parseDetails(item.details);

    const formattedPrice =
            formatPrice(item.price);

    const titleContainer =
            document.querySelector(".container.detail");

    document.getElementById("makeInState").innerText = `${item.make} in ${item.state}`
    document.getElementById("typeInState").innerText = `${item.category} in ${item.state}`

    if (titleContainer) {

      document.getElementById("slide-img").innerHTML = `
      <img class="slide-img" src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/${item.image_cover}" alt="${item.vin}">
    `;

      const priceHTML =
              formattedPrice
                      ? `
<span class="detail-price">
  $<span class="car-total">${formattedPrice}</span>
</span>
`
                      : "";

      titleContainer.innerHTML = `
<h1>
${safe(item.title)}
${priceHTML}
</h1>
`;

    }

    const vinHTML =
            details.vin_lookup
                    ? `
<div class="vin-href">
  <a target="_blank"
     href="${details.vin_lookup}"
     class="vin-link">
     VIN Report
  </a>
  <svg class="vin-next">
    <use xlink:href="#icon-next"></use>
  </svg>
</div>
`
                    : "";

    let extrasHTML = "";

    if (details.extras && Array.isArray(details.extras)) {

      extrasHTML =
              details.extras.join(", ");

    }

    const descriptionHTML =
            safe(item.full_description) ||
            safe(item.description) ||
            safe(item.summary_description);

    const featuresContainer =
            document.querySelector(".detail-features");

    if (!featuresContainer) return;

    featuresContainer.innerHTML = `
<div class="features-top">

  <h2>Detailed Information</h2>

  ${vinHTML}

</div>

<div class="features-content">

<ul>

<li><p><b>Type: </b>${safe(details.type)}</p></li>

<li><p><b>Price: </b>${
            formattedPrice
                    ? "$" + formattedPrice
                    : "Contact for price"
    }</p></li>

<li><p><b>Location: </b>${safe(details.location)}</p></li>

<li><p><b>Condition: </b>${safe(details.condition)}</p></li>

<li><p><b>Make: </b>${safe(details.make)}</p></li>

<li><p><b>Model: </b>${safe(details.model)}</p></li>

<li><p><b>Year: </b>${safe(details.year)}</p></li>

<li><p><b>VIN: </b>${safe(details.vin)}</p></li>

<li><p><b>Mileage: </b>${safe(details.mileage)}</p></li>

<li><p><b>Transmission: </b>${safe(details.transmission)}</p></li>

<li><p><b>Extras: </b>${safe(extrasHTML)}</p></li>

</ul>

</div>

<div class="features-des">

<p>${descriptionHTML}</p>

</div>

<div class="ad-layout"></div>
`;

  }

  /*
  ========================================
  Bottom Cars
  ========================================
  */

  function renderCarsBottom(data) {

    const container =
            document.getElementById('car-bottom');

    container.innerHTML = '';

    data.forEach(car => {

      const image =
              car.image_cover === '404.jpg'
                      ? '404.jpg'
                      : car.image_cover;

      const div =
              document.createElement('div');

      div.className = 'car-con';

      div.innerHTML = `
<div class="car-item">

<a href="./detail.html?id=${car.id}"
class="link-cover"></a>

<div class="car-pic">

<div class="car-pic-pop">POPULAR</div>

<img src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/${image}" alt="${car.title}">

<div class="car-pic-tip">

<svg>
<use xlink:href="#icon-pic"></use>
</svg>

<span class="car-pic-num">1</span>

</div>

</div>

<div class="car-content">

<div class="car-title"></div>

<div class="car-info">

<div class="car-info-item">

<svg>
<use xlink:href="#icon-location"></use>
</svg>

<span>${car.location}</span>

</div>

<div class="car-info-item">

<svg>
<use xlink:href="#icon-date"></use>
</svg>

<span>${car.listing_date}</span>

</div>

</div>

<div class="car-des">

<p>${car.title}</p>

<p>${car.summary_description}</p>

</div>

${
              car.price !== null &&
              car.price !== undefined &&
              car.price !== ''
                      ? `<div class="car-prices">$<span class="car-total">${car.price}</span></div>`
                      : ''
      }

</div>

</div>
`;

      container.appendChild(div);

    });

  }

  async function loadBottom(data) {

    const result =
            await fetchListings({

              state: data.state,
              category: "",
              make: data.make,
              page: 1,
              limit: 15

            });

    if (result.error) {

      console.error(result.error);

      return;

    }

    renderCarsBottom(result.data);

  }

  /*
  ========================================
  Aside Cars
  ========================================
  */

  function renderCarsAside(data) {

    const container =
            document.getElementById('car-aside');

    container.innerHTML = '';

    data.forEach(car => {

      const image =
              car.image_cover === '404.jpg'
                      ? '404.jpg'
                      : car.image_cover;

      const div =
              document.createElement('div');

      div.className = 'car-con';

      div.innerHTML = `
<div class="car-con">

<div class="car-item">

<a href="./detail.html?id=${car.id}"
class="link-cover"></a>

<div class="car-pic">

<img src="https://pub-683228af40b042bb882e1ed4bda118b8.r2.dev/images/${image}" alt="">

<div class="car-pic-tip">

<svg>
<use xlink:href="#icon-pic"></use>
</svg>

<span class="car-pic-num">1</span>

</div>

</div>

<div class="car-content">

<div class="car-title">
${car.title}
</div>

<div class="car-info">

<div class="car-info-item">

<svg>
<use xlink:href="#icon-location"></use>
</svg>

<span>${car.location}</span>

</div>

<div class="car-info-item">

<svg>
<use xlink:href="#icon-date"></use>
</svg>

<span>${car.listing_date}</span>

</div>

</div>

<div class="car-des">
${car.summary_description}
</div>

${
              car.price !== null &&
              car.price !== undefined &&
              car.price !== ''
                      ? `<div class="car-prices">$<span class="car-total">${car.price}</span></div>`
                      : ''
      }

</div>

</div>

</div>
`;

      container.appendChild(div);

    });

  }

  async function loadAside(data) {

    const result =
            await fetchListings({

              state: data.state,
              category: data.category,
              make: "",
              page: 1,
              limit: 15

            });

    if (result.error) {

      console.error(result.error);

      return;

    }

    renderCarsAside(result.data);

  }

  /*
  ========================================
  Init
  ========================================
  */

  document.addEventListener("DOMContentLoaded", async () => {

    const data = await loadDetailPage();

    console.log(data);

    loadBottom(data)

    loadAside(data)

  });

</script>

<script>
  function goForm() {
    window.location.href = "./form.html";
  }

  function goState(){
    window.location.href = "./states.html";
  }
</script>



</body>
</html>